<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Money Tracker - Přehled</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="dashboard-body">

    <div class="quick-actions">
        <h4>Quick Actions</h4>
        <div class="action-buttons">
            <button class="action-btn transfer">⇆</button>
            <button class="action-btn expense">-</button>
            <button class="action-btn income">+</button>
        </div>
    </div>

    <main class="main-content">
        <div class="chart-container">
            <div class="donut-chart">
                <div class="chart-center">
                    <span class="main-balance" id="main-balance-display"></span>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <input type="checkbox" id="cb-owned" class="legend-checkbox owned" data-value="{{ data.owned }}" checked>
                <label for="cb-owned">Owned</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="cb-landed" class="legend-checkbox landed" data-value="{{ data.landed }}" checked>
                <label for="cb-landed">Landed</label>
            </div>
            <div class="legend-item">
                <input type="checkbox" id="cb-owe" class="legend-checkbox owe" data-value="{{ data.owe }}" checked>
                <label for="cb-owe">Owe</label>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            
            const checkboxes = document.querySelectorAll('.legend-checkbox');
            const balanceDisplay = document.getElementById('main-balance-display');
            let currentBalance = 0; // Proměnná pro uložení aktuálního zůstatku

            /**
             * Funkce pro plynulou animaci čísla z jedné hodnoty na druhou.
             * @param {HTMLElement} obj - Element, jehož text se má změnit.
             * @param {number} start - Počáteční číslo.
             * @param {number} end - Cílové číslo.
             * @param {number} duration - Délka animace v milisekundách.
             */
            function animateValue(obj, start, end, duration) {
                let startTimestamp = null;
                const step = (timestamp) => {
                    if (!startTimestamp) startTimestamp = timestamp;
                    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                    const currentValue = Math.floor(progress * (end - start) + start);
                    obj.textContent = currentValue.toLocaleString('cs-CZ') + 'Kč';
                    if (progress < 1) {
                        window.requestAnimationFrame(step);
                    }
                };
                window.requestAnimationFrame(step);
            }

            /**
             * Funkce, která vypočítá nový zůstatek a spustí animaci.
             * @param {boolean} isInitialLoad - Určuje, zda jde o první načtení stránky.
             */
            function calculateAndUpdateBalance(isInitialLoad = false) {
                const previousBalance = currentBalance;
                let newBalance = 0;
                
                checkboxes.forEach(function(checkbox) {
                    if (checkbox.checked) {
                        newBalance += parseInt(checkbox.dataset.value, 10);
                    }
                });

                // Uložíme si nový zůstatek
                currentBalance = newBalance;

                if (isInitialLoad) {
                    // Při prvním načtení stránky nastavíme hodnotu okamžitě, bez animace
                    balanceDisplay.textContent = currentBalance.toLocaleString('cs-CZ') + 'Kč';
                } else {
                    // Při každé další změně spustíme animaci
                    animateValue(balanceDisplay, previousBalance, currentBalance, 500); // Animace trvá 0.5 sekundy
                }
            }

            // Přiřadíme každému checkboxu "posluchače", který při změně zavolá naši funkci
            checkboxes.forEach(function(checkbox) {
                checkbox.addEventListener('change', () => calculateAndUpdateBalance(false));
            });

            // Zavoláme funkci hned na začátku pro zobrazení počátečního součtu
            calculateAndUpdateBalance(true);
        });
    </script>

</body>
</html>